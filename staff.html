<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>C&E's Cafe - Staff Orders</title>
<style>
  body { font-family: Arial, sans-serif; background:#eef4fc; margin:0; padding:0; }
  header { background:#3f7fbf; color:white; text-align:center; padding:15px; }
  h1 { margin:0; }
  main { padding:20px; max-width:800px; margin:auto; }
  .order { border:1px solid #ccc; padding:10px; margin-bottom:10px; background:white; border-radius:5px; position:relative; }
  .fulfilled { color:green; font-size:20px; position:absolute; top:10px; right:10px; }
  button { padding:5px 10px; background:#3f7fbf; color:white; border:none; cursor:pointer; border-radius:3px; }
  button:hover { background:#2e5f9e; }
</style>
</head>
<body>

<header>
  <h1>C&E's Cafe - Staff Orders</h1>
  <button id="enableSound">Enable Notifications</button>
</header>

<main>
  <div id="orders"></div>
</main>

<audio id="bellSound" src="bell.mp3" preload="auto"></audio>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, onChildAdded, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyAIugKjWMFbB8eDLSY5JInBM1lsyQ3bIHo",
  authDomain: "drink-order-test.firebaseapp.com",
  databaseURL: "https://drink-order-test-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "drink-order-test",
  storageBucket: "drink-order-test.firebasedestorage.app",
  messagingSenderId: "90936648282",
  appId: "1:90936648282:web:b9854c3438319db80cae63"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const ordersRef = ref(db, "orders");

const ordersDiv = document.getElementById("orders");
const bell = document.getElementById("bellSound");

document.getElementById("enableSound").addEventListener("click", () => {
  bell.play().then(() => bell.pause());
  alert("Notifications enabled!");
});

onChildAdded(ordersRef, snapshot => {
  const order = snapshot.val();
  const key = snapshot.key;

  const orderDiv = document.createElement("div");
  orderDiv.classList.add("order");
  orderDiv.id = key;

  orderDiv.innerHTML = `
    <strong>Customer:</strong> ${order.customerName}<br>
    <strong>Drink:</strong> ${order.drink}<br>
    <strong>Temperature:</strong> ${order.temperature}<br>
    <strong>Milk:</strong> ${order.milk}<br>
    <strong>Sweetener:</strong> ${order.sweetener}<br>
    <strong>Time:</strong> ${order.timestamp || "Unknown"}<br>
    <button class="fulfillBtn">Mark Fulfilled ✅</button>
  `;

  ordersDiv.prepend(orderDiv);

  // Play bell notification if enabled
  bell.play().catch(()=>{});

  const btn = orderDiv.querySelector(".fulfillBtn");
  btn.addEventListener("click", () => {
    update(ref(db, `orders/${key}`), { fulfilled: true });
    orderDiv.querySelector(".fulfillBtn").remove();
    const check = document.createElement("span");
    check.classList.add("fulfilled");
    check.textContent = "✅";
    orderDiv.appendChild(check);
  });
});
</script>

</body>
</html>
