<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>C&E's Cafe â€“ Staff Orders</title>

<style>
body { font-family:Arial,sans-serif; background:#eef4fc; margin:0; }
header { background:#3f7fbf; color:white; text-align:center; padding:15px; }

.order {
  background:white;
  padding:12px;
  border-radius:6px;
  margin-bottom:12px;
}

.blocked-ip {
  color:#c0392b;
  font-weight:bold;
}

button {
  margin-top:8px;
  padding:6px 12px;
  border:none;
  border-radius:4px;
  background:#3f7fbf;
  color:white;
  cursor:pointer;
}

.block-btn { background:#c0392b; }
.unblock-btn { background:#27ae60; }
</style>
</head>

<body>

<header>
  <h1>Staff Orders</h1>
</header>

<main style="padding:20px;max-width:800px;margin:auto;" id="orders"></main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getDatabase,
  ref,
  onChildAdded,
  update,
  remove,
  get
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAIugKjWMFbB8eDLSY5JInBM1lsyQ3bIHo",
  databaseURL: "https://drink-order-test-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "drink-order-test"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const ordersRef = ref(db, "orders");
const blockedRef = ref(db, "blockedIPs");

const ordersDiv = document.getElementById("orders");

onChildAdded(ordersRef, async snap => {
  const o = snap.val();
  const ip = o.ipAddress || "unknown";

  const blocked = (await get(ref(db, `blockedIPs/${ip}`))).exists();

  const div = document.createElement("div");
  div.className = "order";

  div.innerHTML = `
    <strong>${o.customerName}</strong><br>
    ${o.drink}<br>
    IP: <span class="${blocked ? "blocked-ip" : ""}">${ip}</span><br>
    <button class="${blocked ? "unblock-btn" : "block-btn"}">
      ${blocked ? "Unblock IP" : "Block IP"}
    </button>
  `;

  div.querySelector("button").onclick = () => {
    if (blocked) {
      remove(ref(db, `blockedIPs/${ip}`));
      alert("IP unblocked");
    } else {
      update(ref(db, `blockedIPs/${ip}`), {
        blocked: true,
        blockedAt: Date.now()
      });
      alert("IP blocked");
    }
    location.reload();
  };

  ordersDiv.prepend(div);
});
</script>

</body>
</html>
