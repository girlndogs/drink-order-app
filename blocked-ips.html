<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>C&E's Cafe - Blocked IPs</title>
<style>
body { font-family: Arial, sans-serif; background:#eef4fc; margin:0; }
header { background:#3f7fbf; color:white; text-align:center; padding:16px; position:sticky; top:0; z-index:1000; }
header button { margin-top:10px; padding:8px 14px; background:white; color:#3f7fbf; border:none; border-radius:4px; cursor:pointer; font-weight:bold; }

main { max-width:800px; margin:auto; padding:20px; }
.card { background:white; border-radius:8px; padding:14px; margin-bottom:12px; box-shadow:0 2px 6px rgba(0,0,0,0.1); display:flex; justify-content:space-between; align-items:center; }
.card span { font-weight:bold; }
.unblock-btn { padding:6px 12px; background:#e74c3c; color:white; border:none; border-radius:4px; cursor:pointer; }
.unblock-btn:hover { background:#c0392b; }
</style>
</head>
<body>

<header>
  <h1>Blocked IP Addresses ðŸš«</h1>
  <button onclick="window.location.href='staff.html'">â¬… Back to Orders</button>
</header>

<main>
  <div id="blockedList">
    <p>Loading blocked IPs...</p>
  </div>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

/* Firebase config */
const firebaseConfig = {
  apiKey: "AIzaSyAIugKjWMFbB8eDLSY5JInBM1lsyQ3bIHo",
  authDomain: "drink-order-test.firebaseapp.com",
  databaseURL: "https://drink-order-test-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "drink-order-test",
  storageBucket: "drink-order-test.firebaseappdestorage.app",
  messagingSenderId: "90936648282",
  appId: "1:90936648282:web:b9854c3438319db80cae63"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const blockedRef = ref(db, "blockedIPs");

const listDiv = document.getElementById("blockedList");

// Listen for blocked IPs
onValue(blockedRef, snapshot => {
  const data = snapshot.val();
  listDiv.innerHTML = ""; // clear list
  if(!data) {
    listDiv.innerHTML = "<p>No blocked IPs.</p>";
    return;
  }

  Object.entries(data).forEach(([ip, info]) => {
    const div = document.createElement("div");
    div.className = "card";
    const blockedAt = info.timestamp ? new Date(info.timestamp).toLocaleString() : "Unknown";
    div.innerHTML = `
      <span>${ip}</span>
      <span>Blocked: ${blockedAt}</span>
      <button class="unblock-btn">Unblock</button>
    `;
    div.querySelector(".unblock-btn").onclick = () => {
      if(confirm(`Unblock IP ${ip}?`)) {
        remove(ref(db, `blockedIPs/${ip}`));
        alert(`IP ${ip} has been unblocked.`);
      }
    };
    listDiv.appendChild(div);
  });
});
</script>

</body>
</html>
