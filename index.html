<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>C&E's Cafe â€“ Order</title>

<style>
body { margin:0; font-family:'Segoe UI',sans-serif; background:#f0f4fa; }
header { background:#4a6fa5; color:white; text-align:center; padding:16px; }
.container { max-width:480px; margin:auto; padding:16px; }
.card { background:white; padding:16px; border-radius:12px; margin-bottom:14px; }
button {
  width:100%; padding:12px; border-radius:10px;
  background:#4a6fa5; color:white; font-weight:bold; border:none;
}
button:disabled { background:#9bb0d0; }
.blocked {
  background:#ffe6e6;
  padding:16px;
  border-radius:12px;
  text-align:center;
  color:#a93226;
  font-weight:bold;
}
</style>
</head>

<body>

<header>
  <h2>C&E's Cafe</h2>
</header>

<div class="container" id="app"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getDatabase,
  ref,
  push,
  get
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAIugKjWMFbB8eDLSY5JInBM1lsyQ3bIHo",
  databaseURL: "https://drink-order-test-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "drink-order-test"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const appDiv = document.getElementById("app");

/* Get public IP */
async function getIP() {
  try {
    const r = await fetch("https://api.ipify.org?format=json");
    return (await r.json()).ip;
  } catch {
    return "unknown";
  }
}

const ip = await getIP();

/* Check block list */
const blockedSnap = await get(ref(db, `blockedIPs/${ip}`));
if (blockedSnap.exists()) {
  appDiv.innerHTML = `
    <div class="blocked">
      ðŸš« Ordering from this device has been blocked.<br>
      Please speak to staff if this is a mistake.
    </div>
  `;
  throw new Error("Blocked");
}

/* Render order form */
appDiv.innerHTML = `
  <div class="card"><input id="name" placeholder="Your name"></div>
  <div class="card"><input id="drink" placeholder="Drink"></div>
  <button id="submit">Place Order</button>
`;

document.getElementById("submit").onclick = () => {
  push(ref(db,"orders"), {
    customerName: name.value.trim(),
    drink: drink.value.trim(),
    ipAddress: ip,
    timestamp: Date.now(),
    displayTime: new Date().toLocaleString(),
    fulfilled: false
  }).then(() => alert("Order placed!"));
};
</script>

</body>
</html>
